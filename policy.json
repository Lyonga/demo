DocumentName: AWS-RunPowerShellScript
InstanceIds: '{{ InstanceIds }}'
Parameters:
  commands:
    - New-Item -ItemType Directory -Force -Path C:\Scripts
    # CrowdStrike Installation
    - $csInstaller = "C:\Scripts\CROWDSTRIKE.EXE"
    - $csArgs = "/install /quiet /norestart CID=90A3F76CCAB1486B926DAB2CA88CF712-29"
    - aws s3 cp s3://ngl-ec2-terraform-backend-workloaddev/agents/CROWDSTRIKE.EXE $csInstaller
    - Start-Process -FilePath $csInstaller -ArgumentList $csArgs -Wait

    # Rapid7 Installation
    - $rapid7Installer = "C:\Scripts\RAPID7_X86_64.MSI"
    - $rapid7Args = "/i $rapid7Installer CONFIGCHOICE=LOCAL CUSTOMCONFIGPATH='C:\Scripts' /qn"
    - aws s3 cp s3://ngl-ec2-terraform-backend-workloaddev/agents/RAPID7_X86_64.MSI $rapid7Installer
    - Start-Process -FilePath msiexec.exe -ArgumentList $rapid7Args -Wait

    # Duo Installation
    - $duoInstaller = "C:\Scripts\DUOWINDOWSLOGON64.msi"
    - $duoArgs = "/i $duoInstaller IKEY='DIGAQFXPG4Q2GQJJINA2' SKEY='K7FIgmjChMmBa6G6IJrJvDGc4e6wNZNf9aKGxCPr' HOST='api-550c2cbe.duosecurity.com' AUTOPUSH='#0' FAILOPEN='#0' SMARTCARD='#0' RDPONLY='#0' USERNAMEFORMAT='0' /passive"
    - aws s3 cp s3://ngl-ec2-terraform-backend-workloaddev/agents/DUOWINDOWSLOGON64.msi $duoInstaller
    - Start-Process -FilePath msiexec.exe -ArgumentList $duoArgs -Wait
